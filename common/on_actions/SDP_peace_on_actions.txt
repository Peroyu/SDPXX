on_actions = {
	#### PEACE/WAR VICTORY ON_CAPITULATION BLOCK ####
	#### PUT YOUR SHIT HERE
	# At the end of each global block, set the skip_default_capitulation GLOBAL flag
	# go away stinky vanilla peace

	# FROM = winner 
	# ROOT = country being capitulated/loser

	# DO NOT FUCKING TOUCH THIS
	# I AM DEATHLY FUCKING SERIOUS RIGHT NOW
	# XOXO - Grestin
	# Somtimes I wonder if this system is even worth the pain - Bernie
	# Make sure to space stuff out properly and keep everything neat - Bernie
	on_startup = {
		effect = {
			if = {
				limit = {
					has_start_date < 1947.1.2
					has_start_date > 1946.12.31
				}
				set_global_flag = scriptpeaceconference_warsummary
			}

		}
	}
	on_capitulation = {
		
		effect = {
			if = {
				limit = {
					has_global_flag = scriptpeaceconference_warsummary
				}
				set_global_flag = sp_warpeace_show_gui
				FROM = { save_global_event_target_as = winning_country }
				ROOT = { save_global_event_target_as = losing_country }
				add_to_variable = { global.sp_warpeace_dirty = 1 }
			}
			if = {
				limit = {
					NOT = {
						has_global_flag = PEACE_DEAL_DISABLED
					}
				}
			#### THIS IS INTENTIONAL DO NOT DELETE
			log = "[GetDateText]: FROM: [From.GetName] ROOT: [Root.GetName] on_capitulation"

			set_global_flag = show_peace_popup_alert
			FROM = {
				save_global_event_target_as = winning_country
			} 
			ROOT = {
				save_global_event_target_as = losing_country
			}

			log = "[GetDateText]: winner/loser: FROM: [winning_country.GetName] ROOT: [losing_country.GetName] on_capitulation"

			if = {
				limit = {
					event_target:losing_country = {
						any_allied_country = {
							has_war_together_with = event_target:losing_country
						}
					}
				}
				set_global_flag = losing_country_multiple
			}

			if = {
				limit = {
					event_target:winning_country = {
						any_allied_country = {
							has_war_together_with = event_target:winning_country
						}
					}
				}
				set_global_flag = winning_country_multiple
			}

			#Annexation block
			# this will only trigger ROOT (the loser) is in a faction and is NOT the only survivor of said faction
			# if ROOT is the only survivor then it will trigger the proper effects below
			if = {
				limit = {
					NOT = {
						ROOT = {
							has_country_flag = DO_NOT_DELETE_ME # Seriously don't 
						}
					}
				}
				set_global_flag = war_won

				# normal peace stuff

				######### -------------- #########

				if = { # CJF beats CMA (Chong Qing attact) 
					limit = {
						FROM = {
							OR = {
								original_tag = CJF
								is_in_faction_with = CJF
							}
						}
						ROOT = {
							original_tag = CMA
						}
					}

					FROM = {
						white_peace = ROOT
					}

					CJF = {
						annex_country = {
							target = ROOT
							transfer_troops = no
						}
					}

					CMA = {
						every_unit_leader = {
							set_nationality = NIP
						}
					}

					set_global_flag = skip_default_capitulation
				}
				if = { # KHN beats HNN (Hunan attack) 
				limit = {
					FROM = {
						OR = {
							original_tag = GDC
							is_in_faction_with = GDC
						}
					}
					ROOT = {
						original_tag = HNN
					}
				}

				FROM = {
					white_peace = ROOT
				}

				KHN = {
					annex_country = {
						target = ROOT
						transfer_troops = no
					}
					set_cosmetic_tag = KHN_hunan
					set_capital = { state = 602 }
				}

				set_global_flag = skip_default_capitulation
				}
				if = { # GDC beats GNP (guangdong attack) 
					limit = {
						FROM = {
							OR = {
								original_tag = GDC
								is_in_faction_with = GDC
							}
						}
						ROOT = {
							original_tag = GNP
						}
					}

					FROM = {
						white_peace = ROOT
					}

					GDC = {
						annex_country = {
							target = ROOT
							transfer_troops = no
						}
						load_focus_tree = {
		        			tree = GDC_return_canton
		        			keep_completed = yes
		    			}
						country_event = { 
							days = 1  id = GDCintro.7 
							}
					}
					GHN = {
						transfer_state = 326
						add_state_core = 326
					}
					NIP = {
						set_autonomy = {
							target = GHN
							autonomy_state = autonomy_colony
						}
					}

					set_global_flag = skip_default_capitulation
				}
				if = { # MMA beats SHA (Shaan Xi attack xibei crisis) 
					limit = {
						FROM = {
							OR = {
								original_tag = MMA
								is_in_faction_with = MMA
								is_subject_of = MMA
							}
						}
						ROOT = {
							original_tag = SHA
						}
					}

					FROM = {
						white_peace = ROOT
					}

					MMA = {
						annex_country = {
							target = ROOT
							transfer_troops = no
						}
						country_event = {
							id = SBA.3
							days = 1
						}
						set_autonomy = {
							target = KTR
							autonomy_state = autonomy_free
						}
					}
					SHA = {
						every_unit_leader = {
							set_nationality = NIP
						}
					}
					set_global_flag = skip_default_capitulation
				}

				if = { # CHI beat GHN
					limit = {
						FROM = {
							OR = {
								original_tag = GDC
								is_in_faction_with = GDC
							}
						}
						ROOT = {
							original_tag = GHN
						}
					}

					FROM = {
						white_peace = ROOT
					}

					GDC = {
						annex_country = {
							target = ROOT
							transfer_troops = no
						}
					}

					set_global_flag = skip_default_capitulation
				}

				if = { # CHI beat RCR
					limit = {
						FROM = {
							OR = {
								original_tag = CJF
								is_in_faction_with = CJF
							}
						}
						ROOT = {
							original_tag = RCR
						}
					}

					every_country = {
						limit = {
							has_war_with = RCR
						}
						white_peace = RCR
					}

					if = {
						limit = {
							RCR = {
									is_in_faction_with = NIP 
								
							}
						}
						RCR = {
							leave_faction = yes
						}
					}

					GDC = {
						annex_country = {
							target = ROOT
							transfer_troops = no
						}
					}
					CJF = {
						transfer_state = 911
						transfer_state = 907
						transfer_state = 908
						transfer_state = 620
						transfer_state = 910
						transfer_state = 909
						transfer_state = 606
						transfer_state = 749
						transfer_state = 921
						transfer_state = 922
						transfer_state = 924
						transfer_state = 613
						transfer_state = 837
						transfer_state = 625
						transfer_state = 598
						transfer_state = 931
					}

					set_global_flag = skip_default_capitulation
				}

				if = { # CHI beat FNC
					limit = {
						FROM = {
							OR = {
								original_tag = CJF
								is_in_faction_with = CJF
							}
						}
						ROOT = {
							original_tag = FNC
						}
					}

					every_country = {
						limit = {
							has_war_with = FNC
						}
						white_peace = FNC
					}

					CJF = {
						annex_country = {
							target = ROOT
							transfer_troops = no
						}
					}

					set_global_flag = skip_default_capitulation
				}

				if = { # CHI beat MAN
					limit = {
						FROM = {
							OR = {
								original_tag = CJF
								is_in_faction_with = CJF
							}
						}
						ROOT = {
							original_tag = MAN
						}
					}
					every_country = {
						limit = {
							has_war_with = MAN
						}
						white_peace = MAN
					}

					MAN = {
						set_cosmetic_tag = MAN_kmt
						
					}
					CJF = {
						set_autonomy = {
							target = MAN
							autonomy_state = autonomy_integrated_puppet
						}
					}
					set_global_flag = skip_default_capitulation
				}

				if = { # CHI beat MEN
					limit = {
						FROM = {
							OR = {
								original_tag = CJF
								is_in_faction_with = CJF
							}
						}
						ROOT = {
							original_tag = MEN
						}
					}

					every_country = {
						limit = {
							has_war_with = MEN
						}
						white_peace = MEN
					}

					MMA = {
						annex_country = {
							target = ROOT
							transfer_troops = no
						}
					}

					set_global_flag = skip_default_capitulation
				}

				if = { # CHI beat JIN
					limit = {
						FROM = {
							OR = {
								original_tag = CJF
								is_in_faction_with = CJF
							}
						}
						ROOT = {
							original_tag = MEN
						}
					}

					every_country = {
						limit = {
							has_war_with = JIN
						}
						white_peace = JIN
					}

					JIN = {
						set_cosmetic_tag = JIN_kmt
					}

					CJF = {
						add_to_faction = JIN
					}

					set_global_flag = skip_default_capitulation
				}

				if = { # KOR beat JKR
					limit = {
						FROM = {
							OR = {
								original_tag = KOR
								is_in_faction_with = KOR
							}
						}
						ROOT = {
							original_tag = JKR
						}
					}

					every_country = {
						limit = {
							has_war_with = KOR
						}
						white_peace = KOR
					}

					KOR = {
						annex_country = {
							target = ROOT
							transfer_troops = no
						}
						set_cosmetic_tag = KOR_temgov
						set_capital = { state = 890 }
						set_politics = { 
							ruling_party = conservatism
						}

					}

					set_global_flag = skip_default_capitulation
				}

				if = { # JAP beats CHI (China lost GAW) 
					limit = {
						FROM = {
							OR = {
								original_tag = NIP
								is_in_faction_with = NIP
							}
						}
						ROOT = {
							original_tag = CJF
							is_in_faction_with = CJF
						}
					}

					FROM = {
						white_peace = ROOT
					}

					MMA = {
						if = {
						limit = {
							country_exists = GDC
							}
						annex_country = { target = GDC transfer_troops = yes }
						}
						if = {
						limit = {
							country_exists = CJF
							}
						annex_country = { target = CJF transfer_troops = yes }
						}
						if = {
						limit = {
							country_exists = DJF
							}
						annex_country = { target = DJF transfer_troops = yes }
						}
						if = {
						limit = {
							country_exists = KHN
							}
						annex_country = { target = KHN transfer_troops = yes }
						}
						if = {
						limit = {
							country_exists = SIK
							}
						annex_country = { target = SIK transfer_troops = yes }
						}
						if = {
						limit = {
							country_exists = KTR
							}
						annex_country = { target = KTR transfer_troops = yes }
						}
						set_cosmetic_tag = FCH
					}
					
					NIP = {
						set_autonomy = {
							target = CJF
							autonomy_state = autonomy_puppet
						}
						set_autonomy = {
							target = GDC
							autonomy_state = autonomy_puppet
						}
						set_autonomy = {
							target = DJF
							autonomy_state = autonomy_puppet
						}
						set_autonomy = {
							target = GNP
							autonomy_state = autonomy_puppet
						}
						set_autonomy = {
							target = KGP
							autonomy_state = autonomy_puppet
						}
					}
					CJF = {
						set_cosmetic_tag = CJF_japen
						transfer_state = 753
						transfer_state = 751
						transfer_state = 605
						transfer_state = 857
						transfer_state = 856
						transfer_state = 859
						transfer_state = 858
						transfer_state = 842
						transfer_state = 854
						transfer_state = 855
						transfer_state = 752
					}
					GDC = {
						set_cosmetic_tag = GDC_japen
						transfer_state = 839
						transfer_state = 899
						transfer_state = 599
						transfer_state = 898
						transfer_state = 594
					}
					DJF = {
						set_cosmetic_tag = DJF_japen
						transfer_state = 325
						transfer_state = 747
						transfer_state = 901
					}
					KGP = {
						set_cosmetic_tag = KGP_japen
						transfer_state = 748
						transfer_state = 603
					}
					TIB = {
						transfer_state = 601
						transfer_state = 604
					}
					SHA = {
						transfer_state = 938
						transfer_state = 939
					}
					GNP = {
						transfer_state = 889
						transfer_state = 592
						transfer_state = 728
						transfer_state = 593
						transfer_state = 591
					}
					news_event = {
						id = chi_news.4
						days = 1
					}
					set_global_flag = skip_default_capitulation
				}

				###### INDIA_civilwar #######
				if = { # RAJ beat HYD
					limit = {
						FROM = {
							OR = {
								original_tag = RAJ
								is_in_faction_with = RAJ
							}
						}
						ROOT = {
							original_tag = HYD
						}
					}

					FROM = {
						white_peace = ROOT
					}

					RAJ = {
						annex_country = {
							target = ROOT
							transfer_troops = no
						}
					}

					

					set_global_flag = skip_default_capitulation
				}
				if = { # FID beat HYD
					limit = {
						FROM = {
							OR = {
								original_tag = FID
								is_in_faction_with = FID
							}
						}
						ROOT = {
							original_tag = HYD
						}
					}

					FROM = {
						white_peace = ROOT
					}

					FID = {
						annex_country = {
							target = ROOT
							transfer_troops = no
						}
					}

					

					set_global_flag = skip_default_capitulation
				}
				if = { # AFG beat RAJ
					limit = {
						FROM = {
							OR = {
								original_tag = AFG
								is_in_faction_with = AFG
							}
						}
						ROOT = {
							original_tag = RAJ
						}
					}

					FROM = {
						white_peace = ROOT
						annex = ROOT
					}
					RAJ = {
						set_cosmetic_tag = RIJ
						clr_country_flag = INDIA_civilwar_participants
						if = {
							limit = {
							has_war_with = HYD
							}
							white_peace = HYD
						}
						if = {
							limit = {
							has_war_with = CYN
							}
							white_peace = CYN
						}
					}
					GUI = {
						transfer_state = 428
						add_state_core = 428
					}
					AFG = {
						create_faction = 南亚伊斯兰联盟
						add_to_faction = GUI
						add_to_faction = RAJ
						set_autonomy = {
							target = RAJ
							autonomy_state = autonomy_colony
						}
					}

					

					set_global_flag = skip_default_capitulation
				}
				if = { # AFG beat FID
					limit = {
						FROM = {
							OR = {
								original_tag = AFG
								is_in_faction_with = AFG
							}
						}
						ROOT = {
							original_tag = FID
						}
					}

					FROM = {
						white_peace = ROOT
					}
					FID = {
						clr_country_flag = INDIA_civilwar_participants
					}
					BAG = {
						transfer_state = 430
						transfer_state = 431
						transfer_state = 432
						transfer_state = 434
						transfer_state = 435
					}
					ORI = {
						transfer_state = 426
					}
					AFG = {
						add_to_faction = BAG
						add_to_faction = ORI
					}
					

					set_global_flag = skip_default_capitulation
				}
				if = { # RAJ beat FID
					limit = {
						FROM = {
							OR = {
								original_tag = RAJ
							}
						}
						ROOT = {
							original_tag = FID
						}
					}

					FROM = {
						white_peace = ROOT
					}
					RAJ = {
						annex_country = {
							target = ROOT
							transfer_troops = no
						}
					}
					FID = {
						clr_country_flag = INDIA_civilwar_participants
					}

					set_global_flag = skip_default_capitulation
				}
			}
		}
	}
}
}
