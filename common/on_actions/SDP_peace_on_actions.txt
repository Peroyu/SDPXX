on_actions = {
	#### PEACE/WAR VICTORY ON_CAPITULATION BLOCK ####
	#### PUT YOUR SHIT HERE
	# At the end of each global block, set the skip_default_capitulation GLOBAL flag
	# go away stinky vanilla peace

	# FROM = winner 
	# ROOT = country being capitulated/loser

	# DO NOT FUCKING TOUCH THIS
	# I AM DEATHLY FUCKING SERIOUS RIGHT NOW
	# XOXO - Grestin
	# Somtimes I wonder if this system is even worth the pain - Bernie
	# Make sure to space stuff out properly and keep everything neat - Bernie

	on_capitulation = {
		effect = {
			if = {
				limit = {
					NOT = {
						has_global_flag = PEACE_DEAL_DISABLED
					}
				}
			#### THIS IS INTENTIONAL DO NOT DELETE
			log = "[GetDateText]: FROM: [From.GetName] ROOT: [Root.GetName] on_capitulation"

			set_global_flag = show_peace_popup_alert
			FROM = {
				save_global_event_target_as = winning_country
			} 
			ROOT = {
				save_global_event_target_as = losing_country
			}

			log = "[GetDateText]: winner/loser: FROM: [winning_country.GetName] ROOT: [losing_country.GetName] on_capitulation"

			if = {
				limit = {
					event_target:losing_country = {
						any_allied_country = {
							has_war_together_with = event_target:losing_country
						}
					}
				}
				set_global_flag = losing_country_multiple
			}

			if = {
				limit = {
					event_target:winning_country = {
						any_allied_country = {
							has_war_together_with = event_target:winning_country
						}
					}
				}
				set_global_flag = winning_country_multiple
			}

			#Annexation block
			# this will only trigger ROOT (the loser) is in a faction and is NOT the only survivor of said faction
			# if ROOT is the only survivor then it will trigger the proper effects below
			if = {
				limit = {
					NOT = {
						ROOT = {
							has_country_flag = DO_NOT_DELETE_ME # Seriously don't 
						}
					}
				}
				set_global_flag = war_won

				# normal peace stuff

				######### -------------- #########

				if = { # CJF beats CMA (Chong Qing attact) 
					limit = {
						FROM = {
							OR = {
								original_tag = CJF
								is_in_faction_with = CJF
							}
						}
						ROOT = {
							original_tag = CMA
						}
					}

					FROM = {
						white_peace = ROOT
					}

					CJF = {
						annex_country = {
							target = ROOT
							transfer_troops = no
						}
					}

					set_global_flag = skip_default_capitulation
				}
				if = { # KHN beats HNN (Hunan attack) 
					limit = {
						FROM = {
							OR = {
								original_tag = CJF
								original_tag = KHN
							}
						}
						ROOT = {
							original_tag = HNN
						}
					}

					FROM = {
						white_peace = ROOT
					}

					KHN = {
						annex_country = {
							target = ROOT
							transfer_troops = no
						}
					}

					set_global_flag = skip_default_capitulation
				}
				if = { # GDC beats GNP (guangdong attack) 
					limit = {
						FROM = {
							OR = {
								original_tag = GDC
								is_in_faction_with = GDC
							}
						}
						ROOT = {
							original_tag = GNP
						}
					}

					FROM = {
						white_peace = ROOT
					}

					GDC = {
						annex_country = {
							target = ROOT
							transfer_troops = no
						}
						load_focus_tree = {
		        			tree = GDC_return_canton
		        			keep_completed = yes
		    			}
					}
					GHN = {
						transfer_state = 889
						transfer_state = 326
						add_state_core = 889
						add_state_core = 326
					}
					JAP = {
						set_autonomy = {
							target = GHN
							autonomy_state = autonomy_colony
						}
					}

					set_global_flag = skip_default_capitulation
				}
			}
		}
	}
}
}
