ott_increase_revolt_risk = {
	add_to_variable = { OTT_revolt_risk = 1 }
	clamp_variable = {
		var = OTT_revolt_risk
		min = 0
		max = 5
	}
	if = {
		limit = { TUR = { has_idea = ott_vilayet_stability_idea } }
		custom_effect_tooltip = ott_increase_revolt_risk_tt
		if = {
			limit = {
				is_owned_and_controlled_by = TUR
				is_core_of = TUR
			}
			hidden_effect = {
				if = {
					limit = {
						check_variable = { OTT_revolt_risk > 2 }
						has_resistance = no
						OTT_is_turkish_state = no
					}
					start_resistance = yes
					set_compliance = 15
				}
				if = {
					limit = { check_variable = { OTT_revolt_risk = 5 } }
					if = {
						limit = { has_dynamic_modifier = { modifier = high_revolt_risk } }
						remove_dynamic_modifier = { modifier = high_revolt_risk }
					}
					if = {
						limit = { NOT = { has_dynamic_modifier = { modifier = very_high_revolt_risk } } }
						add_dynamic_modifier = { modifier = very_high_revolt_risk }
					}
				}
				else_if = {
					limit = { check_variable = { OTT_revolt_risk = 4 } }
					if = {
						limit = { NOT = { has_dynamic_modifier = { modifier = high_revolt_risk } } }
						add_dynamic_modifier = { modifier = high_revolt_risk }
					}
				}
				ott_evaluate_stabillity_modifier = yes
			}
		}
	}
}

ott_decrease_revolt_risk = {
	add_to_variable = { OTT_revolt_risk = -1 }
	clamp_variable = {
		var = OTT_revolt_risk
		min = 0
		max = 5
	}
	if = {
		limit = { TUR = { has_idea = ott_vilayet_stability_idea } }
		custom_effect_tooltip = ott_decrease_revolt_risk_tt
		if = {
			limit = {
				is_owned_and_controlled_by = TUR
				is_core_of = TUR
			}
			hidden_effect = {
				if = {
					limit = {
						check_variable = { OTT_revolt_risk < 3 }
						has_resistance = yes
						OTT_is_turkish_state = no
					}
					cancel_resistance = yes
					force_enable_resistance = { occupier = TUR clear = yes }
				}
				if = {
					limit = { check_variable = { OTT_revolt_risk = 4 } }
					if = {
						limit = { has_dynamic_modifier = { modifier = very_high_revolt_risk } }
						remove_dynamic_modifier = { modifier = very_high_revolt_risk }
					}
					if = {
						limit = { NOT = { has_dynamic_modifier = { modifier = high_revolt_risk } } }
						add_dynamic_modifier = { modifier = high_revolt_risk }
					}
				}
				else_if = {
					limit = { check_variable = { OTT_revolt_risk = 3 } }
					if = {
						limit = { has_dynamic_modifier = { modifier = high_revolt_risk } }
						remove_dynamic_modifier = { modifier = high_revolt_risk }
					}
				}
				ott_evaluate_stabillity_modifier = yes
			}
		}
	}
}

ott_set_authority_vilayet_low = {
	set_variable = { OTT_authority_level = 1 }
	if = {
		limit = { TUR = { has_idea = ott_vilayet_stability_idea } }
		custom_effect_tooltip = ott_authority_low
		if = {
			limit = {
				is_owned_and_controlled_by = TUR
				is_core_of = TUR
			}
			hidden_effect = {
				if = {
					limit = { has_dynamic_modifier = { modifier = vilayet } }
					remove_dynamic_modifier = { modifier = vilayet }
				}
				if = {
					limit = { NOT = { has_dynamic_modifier = { modifier = autonomous_region } } }
					add_dynamic_modifier = { modifier = autonomous_region }
				}
			}
		}
	}
}

ott_set_authority_vilayet_medium = {
	set_variable = { OTT_authority_level = 2 }
	if = {
		limit = { TUR = { has_idea = ott_vilayet_stability_idea } }
		custom_effect_tooltip = ott_authority_medium
		if = {
			limit = {
				is_owned_and_controlled_by = TUR
				is_core_of = TUR
			}
			hidden_effect = {
				if = {
					limit = { has_dynamic_modifier = { modifier = autonomous_region } }
					remove_dynamic_modifier = { modifier = autonomous_region }
				}
				if = {
					limit = { NOT = { has_dynamic_modifier = { modifier = vilayet } } }
					add_dynamic_modifier = { modifier = vilayet }
				}
			}
		}
	}
}

ott_set_authority_vilayet_high = {
	set_variable = { OTT_authority_level = 3 }
	if = {
		limit = { TUR = { has_idea = ott_vilayet_stability_idea } }
		custom_effect_tooltip = ott_authority_high
		if = {
			limit = {
				is_owned_and_controlled_by = TUR
				is_core_of = TUR
			}
			hidden_effect = {
				if = {
					limit = { has_dynamic_modifier = { modifier = autonomous_region } }
					remove_dynamic_modifier = { modifier = autonomous_region }
				}
				if = {
					limit = { has_dynamic_modifier = { modifier = vilayet } }
					remove_dynamic_modifier = { modifier = vilayet }
				}
			}
		}
	}
}

ott_increase_authority_vilayet = {
	if = {
		limit = { OTT_is_autonomous_region = yes }
		ott_set_authority_vilayet_medium = yes
	}
	else = {
		ott_set_authority_vilayet_high = yes
	}
	OTT_evaluate_centralisation = yes
}

ott_decrease_authority_vilayet = {
	if = {
		limit = { OTT_is_ottoman_province = yes }
		ott_set_authority_vilayet_medium = yes
	}
	else = {
		ott_set_authority_vilayet_low = yes
	}
	OTT_evaluate_centralisation = yes
}

ott_set_revolt_risk_none = {
	set_variable = { OTT_revolt_risk = 0 }
	hidden_effect = {
		if = {
			limit = { TUR = { has_idea = ott_vilayet_stability_idea } }
			if = {
				limit = {
					is_owned_and_controlled_by = TUR
					is_core_of = TUR
				}
				if = {
					limit = { has_dynamic_modifier = { modifier = high_revolt_risk } }
					remove_dynamic_modifier = { modifier = high_revolt_risk }
				}
				if = {
					limit = { has_dynamic_modifier = { modifier = very_high_revolt_risk } }
					remove_dynamic_modifier = { modifier = very_high_revolt_risk }
				}
				if = {
					limit = {
						has_resistance = yes
						OTT_is_turkish_state = no
					}
					cancel_resistance = yes
				}
				ott_evaluate_stabillity_modifier = yes
			}
		}
	}
}

ott_set_revolt_risk_very_low = {
	set_variable = { OTT_revolt_risk = 1 }
	hidden_effect = {
		if = {
			limit = { TUR = { has_idea = ott_vilayet_stability_idea } }
			if = {
				limit = {
					is_owned_and_controlled_by = TUR
					is_core_of = TUR
				}
				if = {
					limit = { has_dynamic_modifier = { modifier = high_revolt_risk } }
					remove_dynamic_modifier = { modifier = high_revolt_risk }
				}
				if = {
					limit = { has_dynamic_modifier = { modifier = very_high_revolt_risk } }
					remove_dynamic_modifier = { modifier = very_high_revolt_risk }
				}
				if = {
					limit = {
						has_resistance = yes
						OTT_is_turkish_state = no
					}
					cancel_resistance = yes
				}
				ott_evaluate_stabillity_modifier = yes
			}
		}
	}
}

ott_set_revolt_risk_low = {
	set_variable = { OTT_revolt_risk = 2 }
	hidden_effect = {
		if = {
			limit = { TUR = { has_idea = ott_vilayet_stability_idea } }
			if = {
				limit = {
					is_owned_and_controlled_by = TUR
					is_core_of = TUR
				}
				if = {
					limit = { has_dynamic_modifier = { modifier = high_revolt_risk } }
					remove_dynamic_modifier = { modifier = high_revolt_risk }
				}
				if = {
					limit = { has_dynamic_modifier = { modifier = very_high_revolt_risk } }
					remove_dynamic_modifier = { modifier = very_high_revolt_risk }
				}
				if = {
					limit = {
						has_resistance = yes
						OTT_is_turkish_state = no
					}
					cancel_resistance = yes
				}
				ott_evaluate_stabillity_modifier = yes
			}
		}
	}
}

ott_set_revolt_risk_medium = {
	set_variable = { OTT_revolt_risk = 3 }
	hidden_effect = {
		if = {
			limit = { TUR = { has_idea = ott_vilayet_stability_idea } }
			if = {
				limit = {
					is_owned_and_controlled_by = TUR
					is_core_of = TUR
				}
				if = {
					limit = { has_dynamic_modifier = { modifier = high_revolt_risk } }
					remove_dynamic_modifier = { modifier = high_revolt_risk }
				}
				if = {
					limit = { has_dynamic_modifier = { modifier = very_high_revolt_risk } }
					remove_dynamic_modifier = { modifier = very_high_revolt_risk }
				}
				if = {
					limit = {
						has_resistance = no
						OTT_is_turkish_state = no
					}
					start_resistance = yes
					set_compliance = 15
				}
				ott_evaluate_stabillity_modifier = yes
			}
		}
	}
}

ott_set_revolt_risk_high = {
	set_variable = { OTT_revolt_risk = 4 }
	hidden_effect = {
		if = {
			limit = { TUR = { has_idea = ott_vilayet_stability_idea } }
			if = {
				limit = {
					is_owned_and_controlled_by = TUR
					is_core_of = TUR
				}
				if = {
					limit = { has_dynamic_modifier = { modifier = very_high_revolt_risk } }
					remove_dynamic_modifier = { modifier = very_high_revolt_risk }
				}
				if = {
					limit = { NOT = { has_dynamic_modifier = { modifier = high_revolt_risk } } }
					add_dynamic_modifier = { modifier = high_revolt_risk }
				}
				if = {
					limit = {
						has_resistance = no
						OTT_is_turkish_state = no
					}
					start_resistance = yes
					set_compliance = 5
				}
				ott_evaluate_stabillity_modifier = yes
			}
		}
	}
}

ott_set_revolt_risk_very_high = {
	set_variable = { OTT_revolt_risk = 5 }
	hidden_effect = {
		if = {
			limit = { TUR = { has_idea = ott_vilayet_stability_idea } }
			if = {
				limit = {
					is_owned_and_controlled_by = TUR
					is_core_of = TUR
				}
				if = {
					limit = { has_dynamic_modifier = { modifier = high_revolt_risk } }
					remove_dynamic_modifier = { modifier = high_revolt_risk }
				}
				if = {
					limit = { NOT = { has_dynamic_modifier = { modifier = very_high_revolt_risk } } }
					add_dynamic_modifier = { modifier = very_high_revolt_risk }
				}
				if = {
					limit = {
						has_resistance = no
						OTT_is_turkish_state = no
					}
					start_resistance = yes
					set_resistance = 40
				}
				ott_evaluate_stabillity_modifier = yes
			}
		}
	}
}

ott_evaluate_stabillity_modifier = {
	TUR = {
		if = {
			limit = { has_idea = ott_vilayet_stability_idea }
			set_variable = { var_state_stability = 0 }
			hidden_effect = {
				every_owned_state = {
					limit = { has_variable = OTT_revolt_risk }
					if = {
						limit = {
							check_variable = { OTT_revolt_risk = 5 }
						}
						add_to_variable = { TUR.var_state_stability = -0.05 }
					}
					else_if = {
						limit = {
							check_variable = { OTT_revolt_risk = 4 }
						}
						add_to_variable = { TUR.var_state_stability = -0.03 }
					}
					else_if = {
						limit = {
							check_variable = { OTT_revolt_risk = 3 }
						}
						add_to_variable = { TUR.var_state_stability = -0.02 }
					}
					else_if = {
						limit = {
							check_variable = { OTT_revolt_risk = 2 }
						}
						add_to_variable = { TUR.var_state_stability = -0.01 }
					}
				}
			}
			force_update_dynamic_modifier = yes
		}
		else = {
			clear_variable = var_state_stability
		}
	}
}

OTT_evaluate_centralisation = {
	TUR = {
		if = {
			limit = { has_idea = ott_centralisation_idea }
			set_variable = { centralisation = 0 }
			every_core_state = {
				limit = {
					OTT_is_turkish_state = no
					OTT_is_ottoman_province = yes
				}
				add_to_variable = { TUR.centralisation = 1 }
			}
			divide_variable = { centralisation = 100 }
			force_update_dynamic_modifier = yes
		}
		else = {
			clear_variable = centralisation
		}
	}
}

OTT_evaluate_parliament_support = {
	TUR = {
		if = {
			limit = { has_idea = ott_parliament_idea }
			set_variable = { parliament = representatives_support }
			divide_variable = { parliament = 1000 }
			force_update_dynamic_modifier = yes
			if = {
				limit = {
					is_ai = yes
					check_variable = { representatives_support < 250 }
					set_temp_variable = { coalition_partner_to_check = token:market_liberal }
					has_coalition_with_target = yes
				}
				country_event = ottgui.3
			}
			hidden_effect = {
				country_event = { id = ottlib.20 days = 30 }
			}
		}
		else = {
			clear_variable = parliament
		}
	}
}

OTT_recalc_congress_icon_frames = {
	TUR = {
		if = {
			limit = { has_idea = ott_parliament_idea }
			set_variable = { current_house_icon_frame = representatives_support }
			divide_variable = { current_house_icon_frame = representatives_total }
			multiply_variable = { current_house_icon_frame = 21 }
			round_variable = current_house_icon_frame
			clamp_variable = {
				var = current_house_icon_frame
				min = 1
				max = 21
			}
		}
		else = {
			clear_variable = current_house_icon_frame
		}
	}
}

OTT_calc_coalition_strength = {
	TUR = {
		if = {
			limit = { has_idea = ott_parliament_idea }
			clamp_variable = {
				var = nat_tur_sup_deputies
				min = 0
				max = nat_tur_deputies
			}
			clamp_variable = {
				var = nat_ara_sup_deputies
				min = 0
				max = nat_ara_deputies
			}
			clamp_variable = {
				var = con_sup_deputies
				min = 0
				max = con_deputies
			}
			clamp_variable = {
				var = ind_sup_deputies
				min = 0
				max = ind_deputies
			}
			set_variable = {
				var = representatives_support
				value = 0
			}
			add_to_variable = { representatives_support = nat_ara_sup_deputies }
			add_to_variable = { representatives_support = nat_tur_sup_deputies }
			add_to_variable = { representatives_support = con_sup_deputies }
			add_to_variable = { representatives_support = ind_sup_deputies }

			if = {
				limit = {
					OR = {
						has_government = social_liberal
						has_government = social_conservative
					}
				}
				add_to_variable = { representatives_support = hif_deputies }
			}
			if = {
				limit = {
					OR = {
						has_government = market_liberal
						has_variable = is_in_coalition_with_@token:market_liberal
					}
				}
				add_to_variable = { representatives_support = odf_deputies }
			}
			clamp_variable = {
				var = representatives_support
				min = 0
				max = representatives_total
			}
			OTT_recalc_congress_icon_frames = yes
			OTT_evaluate_parliament_support = yes

			### Fire conservative take-over event chain
			hidden_effect = {
				country_event = { id = ottsab.26 days = 30 }
			}
		}
	}
}

OTT_parliament_low_support_penalty = {
	if = {
		limit = { check_variable = { representatives_support < 250 } }
		custom_effect_tooltip = ott_plurality_congress_deficit_tt

		set_temp_variable = { OTT_pp_loss = 250 }
		subtract_from_temp_variable = { OTT_pp_loss = representatives_support }
		multiply_temp_variable = { OTT_pp_loss = -1 }
		add_political_power = OTT_pp_loss

		set_temp_variable = { OTT_stab_loss = 250 }
		subtract_from_temp_variable = { OTT_stab_loss = representatives_support }
		multiply_temp_variable = { OTT_stab_loss = -0.003 }
		add_stability = OTT_stab_loss

		custom_effect_tooltip = tooltip_white_line
	}
}

OTT_parliament_very_low_support_penalty = {
	if = {
		limit = { check_variable = { representatives_support < 125 } }
		custom_effect_tooltip = ott_plurality_congress_deficit_tt

		set_temp_variable = { OTT_pp_loss = 125 }
		subtract_from_temp_variable = { OTT_pp_loss = representatives_support }
		multiply_temp_variable = { OTT_pp_loss = -1 }
		add_political_power = OTT_pp_loss

		set_temp_variable = { OTT_stab_loss = 125 }
		subtract_from_temp_variable = { OTT_stab_loss = representatives_support }
		multiply_temp_variable = { OTT_stab_loss = -0.003 }
		add_stability = OTT_stab_loss

		custom_effect_tooltip = tooltip_white_line
	}
}

OTT_launch_revolts = {
	### Syria
	if = {
		limit = {
			OR = {
				state = 554
				state = 455
				state = 677
				state = 995
				state = 992
			}
		}
		custom_effect_tooltip = ott_resistance_syr_tt
		if = {
			limit = {
				state = 554
			}
			TUR = {
				country_event = syrrev.2
			}
		}
		else_if = {
			limit = {
				state = 455
			}
			TUR = {
				country_event = syrrev.3
			}
		}
		else_if = {
			limit = {
				state = 677
			}
			TUR = {
				country_event = syrrev.5
			}
		}
		else_if = {
			limit = {
				state = 995
			}
			TUR = {
				country_event = syrrev.6
			}
		}
		else_if = {
			limit = {
				state = 992
			}
			TUR = {
				country_event = syrrev.7
			}
		}
	}

	### Cyrenaica
	else_if = {
		limit = {
			OR = {
				state = 448
				state = 273
				state = 450
				state = 663
				state = 451
				state = 1009
			}
		}
		custom_effect_tooltip = ott_resistance_lba_tt
		if = {
			limit = {
				state = 448
			}
			TUR = {
				country_event = librev.2
			}
		}
		else_if = {
			limit = {
				state = 273
			}
			TUR = {
				country_event = librev.1
			}
		}
		else_if = {
			limit = {
				state = 450
			}
			TUR = {
				country_event = librev.3
			}
		}
		else_if = {
			limit = {
				OR = {
					state = 663
					state = 451
					state = 1009
				}
			}
			TUR = {
				country_event = librev.4
			}
		}
	}

	### Greek Isles
	else_if = {
		limit = {
			OR = {
				state = 183
				state = 164
				state = 187
			}
		}
		custom_effect_tooltip = ott_resistance_cyp_tt
		if = {
			limit = {
				state = 183
			}
			TUR = {
				country_event = cyp.1
			}
		}
		else_if = {
			limit = {
				state = 164
			}
			TUR = {
				country_event = cyp.2
			}
		}
		else_if = {
			limit = {
				state = 187
			}
			TUR = {
				country_event = cyp.3
			}
		}
	}

	### Hejaz
	else_if = {
		limit = {
			OR = {
				state = 754
				state = 679
			}
		}
		custom_effect_tooltip = ott_resistance_hej_tt
		if = {
			limit = {
				state = 754
			}
			TUR = {
				country_event = hejrev.2
			}
		}
		else_if = {
			limit = {
				state = 679
			}
			TUR = {
				country_event = hejrev.1
			}
		}
	}

	### Iraq
	else_if = {
		limit = {
			state = 291
		}
		custom_effect_tooltip = ott_resistance_irq_tt
		TUR = {
			country_event = irqrev.1
		}
	}
}

